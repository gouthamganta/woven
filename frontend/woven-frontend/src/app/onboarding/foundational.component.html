<woven-onboarding-shell
  title="Foundational"
  subtitle="Answer a few prompts so Woven can match you better."
  [stepNumber]="4"
  [totalSteps]="6"
  stepLabel="Profile"
>
  <style>
    .pillRow { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px; }
    .pill {
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.6);
      font-size:12px; opacity:.85;
    }
    .notice {
      margin: 10px 0 14px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(0,0,0,.03);
      font-size: 13px;
      line-height: 1.35;
      opacity: .9;
    }

    .qWrap { display:grid; gap:10px; }
    .qMeta { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .qMeta .small { font-size:12px; opacity:.7; }

    .prompt {
      font-size: 12px;
      opacity: .7;
    }

    .question {
      font-size: 16px;
      line-height: 1.35;
      font-weight: 650;
      letter-spacing: -0.01em;
      margin-top: 4px;
    }

    textarea {
      width:100%;
      min-height: 120px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.15);
      outline: none;
      background: rgba(255,255,255,.85);
      resize: vertical;
      font-size: 14px;
      line-height: 1.4;
    }
    textarea:focus{
      border-color:#111;
      box-shadow: 0 0 0 3px rgba(0,0,0,.08);
    }

    .counterRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      opacity:.7;
      margin-top: 6px;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 14px;
    }

    .btn {
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.7);
      cursor: pointer;
      font-weight: 650;
      flex: 1;
    }
    .btnPrimary{
      background:#111;
      color:#fff;
      border: 0;
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    .error {
      color:#b00020;
      font-size:13px;
      margin-top:8px;
    }

    .center { text-align:center; padding: 14px 0; opacity:.7; }
  </style>

  <div class="pillRow">
    <div class="pill">Version: <b>{{ version }}</b></div>
    <div class="pill">Progress: <b>{{ currentIndex + 1 }}</b> / 5</div>
    <button
      *ngIf="allowSkip"
      type="button"
      class="pill"
      (click)="defer()"
      [disabled]="saving"
      style="cursor:pointer; pointer-events:auto;"
    >
      Skip for now
    </button>
  </div>

  <div class="notice">
    <b>Private:</b> These questions and your answers won’t show on your public profile.
    They’re only used to improve your matches.
  </div>

  <div *ngIf="loading" class="center">Loading questions…</div>

  <div *ngIf="!loading && !hasQuestions()" class="center">
    Question set isn’t ready. Refresh the page.
  </div>

  <div *ngIf="!loading && hasQuestions()" class="qWrap">
    <div class="qMeta">
      <div class="small">Question {{ currentIndex + 1 }} of 5</div>
      <div class="prompt">{{ helperPrompts[currentIndex] }}</div>
    </div>

    <div class="question">
      {{ currentQuestion()?.text }}
    </div>

    <textarea
      [(ngModel)]="answers[currentIndex].answer"
      [attr.maxLength]="maxCharsPerAnswer"
      placeholder="Type your answer…"
    ></textarea>

    <div class="counterRow">
      <div>{{ currentLen() }} / {{ maxCharsPerAnswer }}</div>
      <div *ngIf="!canNext()" style="opacity:.75;">
        Min {{ minCharsPerAnswer }} chars to continue
      </div>
    </div>

    <div *ngIf="error" class="error">{{ error }}</div>

    <div class="actions">
      <button
        type="button"
        class="btn"
        (click)="back(); $event.stopPropagation();"
        [disabled]="saving || currentIndex === 0"
      >
        Back
      </button>

      <button
        *ngIf="currentIndex < 4"
        type="button"
        class="btn btnPrimary"
        (click)="next(); $event.stopPropagation();"
        [disabled]="saving || !canNext()"
      >
        Next
      </button>

      <button
        *ngIf="currentIndex === 4"
        type="button"
        class="btn btnPrimary"
        (click)="submit(); $event.stopPropagation();"
        [disabled]="saving || !canSubmit()"
      >
        {{ saving ? 'Saving…' : 'Finish' }}
      </button>
    </div>
  </div>
</woven-onboarding-shell>

